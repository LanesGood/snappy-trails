function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var t={};function r(e){return.000621371192*e}function n(e){return new Date(e).toISOString().slice(11,-5)}function a(e,t){return Math.round(e*t)/t}function o(e,t,r,n){var a=e+t/60+r/3600;return"S"!=n&&"W"!=n||(a*=-1),a}e(t,"state",(()=>s)),e(t,"addImage",(()=>c)),e(t,"removeImage",(()=>l)),e(t,"sortImages",(()=>u)),e(t,"setTransportMode",(()=>m)),e(t,"getExifData",(()=>p)),e(t,"getRoute",(()=>g)),e(t,"getPosition",(()=>h));const i={foot:"Hike",bike:"Bike",car:"Car"},d="db56c0cf-613e-456d-baea-46650066da62",s={images:[],transportMode:"foot",routeData:{}};function c(e){s.images.push(e)}function l(e,t){s.images=s.images.filter((r=>r[e]!==t))}function u(e){s.images=s.images.sort(((t,r)=>e.indexOf(t.imgId)-e.indexOf(r.imgId))).map(((e,t)=>({...e,imgOrder:t})))}function m(e){s.transportMode=e}function p(e){return new Promise((function(t,r){EXIF.getData(e,(function(){const{DateTime:e,GPSImgDirection:n,GPSImgDirectionRef:a,GPSLatitudeRef:i,GPSLatitude:d,GPSLongitudeRef:s,GPSLongitude:c,Make:l,Model:u}=EXIF.getAllTags(this),m=o(d[0],d[1],d[2],i),p=o(c[0],c[1],c[2],s);t({DateTime:e,GPSImgDirection:n,GPSImgDirectionRef:a,latitude:m,longitude:p,Make:l,Model:u}),r(new Error("There was an error "))}))}))}async function g(e){try{const t=s.images.sort(((e,t)=>e.imgOrder-t.imgOrder)).map((({latitude:e,longitude:t})=>[+t,+e])),r=new URLSearchParams({key:d}).toString(),n=await fetch(`https://graphhopper.com/api/1/route?${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({profile:e,points:t,points_encoded:!1})}),a=await n.json();if(!n.ok)throw new Error(`${a.message}`);return a}catch(e){return console.error(e),e}}const h=function(){return new Promise((function(e,t){navigator.geolocation.getCurrentPosition(e,t)}))};var f=new class{uploadForm=document.querySelector("#upload-form");fileInput=document.querySelector("#fileInput");transportButtons=document.querySelectorAll("input[name=transport-mode]");_clearBtn=document.querySelector("#clear-btn");_userLocationInput=document.querySelector("#user-location");imageList=document.querySelector("#image_list");dropZone=document.querySelector("#drop_zone");routePreviewCard;routePanel;locationPreviewCard;addHandlerFileInput(e){this.fileInput.addEventListener("change",(async function(t){const r=this.files;r.length&&e(r)}))}addHandlerTransportButton(e){this.transportButtons.forEach((t=>t.addEventListener("click",(function(t){e(t)}))))}addHandlerDropInput(e){["dragenter","dragover","dragleave","drop"].forEach((e=>{this.dropZone.addEventListener(e,a,!1)})),["dragenter","dragover"].forEach((e=>{this.dropZone.addEventListener(e,r,!1)})),["dragleave","drop"].forEach((e=>{this.dropZone.addEventListener(e,n,!1)})),this.dropZone.addEventListener("drop",(async function(t){let r=t.dataTransfer.files;r.length&&e(r)}),!1);const t=document.querySelector("#drop_zone small");function r(e){this.classList.add("highlight"),t.innerText="Drop images to upload"}function n(e){this.classList.remove("highlight"),t.innerText="Upload up to 10 images"}function a(e){e.preventDefault(),e.stopPropagation()}}addHandlerRemoveImage(e){this.imageList.addEventListener("click",(function(t){t.preventDefault();if(!t.target.closest(".preview__card--remove-btn"))return;t.stopImmediatePropagation();const r=t.target.closest(".preview__card").dataset.imgId;e(r)}),!0)}addHandlerPreviewClick(e){this.imageList.addEventListener("click",(function(t){t.preventDefault();const r=t.target.closest(".preview__card")?.dataset.imgId;r&&e(r)}))}addHandlerRouteCardClick(e){document.addEventListener("click",(function(t){t.target.closest(".preview__card--route")&&e()}))}addHandlerLocationPreviewClick(e){this.imageList.addEventListener("click",(function(t){t.preventDefault();t.target.closest(".preview__card--location")&&e()}))}addHandlerRemoveCurrentLocation(e){this.imageList.addEventListener("click",(function(t){if(!t.target.closest(".location__card--remove-btn"))return;t.stopImmediatePropagation(),e();document.querySelector("#user-location").checked=!1}))}addHandlerSubmit(e){this.uploadForm.addEventListener("submit",(async t=>{t.preventDefault();const r=new FormData(this.uploadForm).get("transport-mode");e(r)}))}addHandlerClear(e){this._clearBtn.addEventListener("click",(t=>{e()}))}addHandlerUserLocation(e){this._userLocationInput.addEventListener("change",(t=>e(t)))}addHandlerRoutePanelBack(e){document.addEventListener("click",(function(t){t.target.closest(".route-panel--back-btn")&&e()}))}addHandlerDragPreviewCard(e){this.imageList.addEventListener("dragstart",(function(e){const t=e.target.closest(".preview__card");t&&t.classList.add("dragging")})),this.imageList.addEventListener("dragend",(function(e){const t=e.target.closest(".preview__card");t&&t.classList.remove("dragging")})),this.imageList.addEventListener("dragover",(function(e){e.preventDefault();const t=document.querySelector(".dragging"),r=(n=this,a=e.clientY,[...n.querySelectorAll(".preview__card:not(.dragging)")].reduce(((e,t)=>{const r=t.getBoundingClientRect(),n=a-r.top-r.height/2;return n<0&&n>e.offset?{offset:n,element:t}:e}),{offset:Number.NEGATIVE_INFINITY}).element);var n,a;null==r?this.appendChild(t):this.insertBefore(t,r);[...this.querySelectorAll(".preview__card")].forEach(((e,t)=>{e.setAttribute("data-img-order",t)}))})),this.imageList.addEventListener("drop",(function(t){t.preventDefault(),e()}))}renderPreviewCard({file:e,file:{exifdata:t},latitude:r,longitude:n,imgId:a,imgOrder:o}){const i=document.createElement("div");i.classList.add("preview__card"),i.setAttribute("draggable","true"),i.setAttribute("title","Drag to reorder image"),i.dataset.imgOrder=o,i.dataset.imgId=a;const d=document.createElement("div");d.classList.add("preview__card--header");const s=document.createElement("div");s.classList.add("preview__card--text");const c=document.createElement("button");c.innerText="✕",c.setAttribute("title","Remove this item"),c.classList.add("preview__card--remove-btn");const l=document.createElement("img");if(l.classList.add("preview__image"),l.src=URL.createObjectURL(e),l.onload=()=>{URL.revokeObjectURL(l.src)},s.innerHTML=`\n      <dl>\n        <dt>lat, lng: </dt><dd>${r.toFixed(2)}, ${n.toFixed(2)}</dd>\n        <dt>Camera:</dd><dd> ${t.Make} ${t.Model}</dd>\n      </dl>\n    `,t.DateTime){const[e,r,n,a,o,i]=t.DateTime.split(/[: ]/),d=new Date(e,r-1,n,a,o,i);d&&s.insertAdjacentHTML("afterbegin",`<dl>\n            <dt>Date:</dt><dd>${d.toLocaleDateString()}</dd>\n            <dt>Time:</dt><dd>${d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</dd>\n          </dl>\n          `)}d.appendChild(l),i.appendChild(d),i.appendChild(c),i.appendChild(s),this.imageList.insertAdjacentElement("beforeend",i)}renderRoutePreviewCard(e,t){const o=n(e.paths[0].time),d=e.paths[0].distance;document.getElementsByClassName("preview__card--route").length||(this.routePreviewCard=document.createElement("div"),this.routePreviewCard.classList.add("preview__card--text","preview__card--route","preview__card"),this.imageList.insertAdjacentElement("beforebegin",this.routePreviewCard)),this.routePreviewCard.innerHTML=`\n    <h4>${i[t]} Route</h4>\n    <span><h4>${o}</h4>\n    <p>${a(r(d),100)} mi</p>\n    </span>\n    <h4>Details  ➡</h4>\n    `}renderRoutePanel(e,t){const o=i[t],d=n(e.paths[0].time),s=e.paths[0].distance;document.getElementsByClassName("route-panel").length||(this.routePanel=document.createElement("div"),this.routePanel.classList.add("route-panel","preview__card--text"));const c=document.createElement("header"),l=document.createElement("h2");l.innerHTML=`${o} Route`,c.appendChild(l);const u=e.paths[0].points.coordinates[0].map((e=>e.toFixed(3))).join(", "),m=e.paths[0].points.coordinates.pop().map((e=>e.toFixed(3))).join(", "),p=document.createElement("div");p.classList.add("route-panel__overview"),p.innerHTML=`\n    <p>From: <strong>${u}</strong></p>\n    <p>To: <strong>${m}</strong></p>\n    `,p.insertAdjacentHTML("beforeend",`<p class="route-length"><strong>${d}</strong> (${a(r(s),100)} miles)</p>`);const g=document.createElement("button");g.innerText="←",g.setAttribute("title","Back to image list"),g.classList.add("route-panel--back-btn","btn--small"),p.appendChild(g),c.appendChild(p),this.routePanel.appendChild(c);const h=document.createElement("dl");h.innerHTML=`${e.paths[0].instructions.map(((e,t)=>`\n        <dt>${t+1}</dt>\n        <dd>${e.text}</dd>\n        `)).join("")}`,this.routePanel.appendChild(h),this.imageList.replaceChildren(this.routePanel)}renderLocationCard(e){if(!e)return;document.getElementsByClassName("preview__card--location").length||(this.locationPreviewCard=document.createElement("div"),this.locationPreviewCard.classList.add("preview__card","preview__card--location","preview__card--text"),this.locationPreviewCard.setAttribute("draggable","true"),this.imageList.insertAdjacentElement("afterbegin",this.locationPreviewCard)),this.locationPreviewCard.innerHTML=`\n      <header><h4>Current Location: </h4>\n      <span><p>${e[0].toFixed(2)},${e[1].toFixed(2)}</p>\n      </span></header>\n    `,this.locationPreviewCard.dataset.imgId="currentCoords",this.locationPreviewCard.dataset.imgOrder=0;const t=document.createElement("button");t.innerText="x",t.setAttribute("title","Remove current location"),t.classList.add("location__card--remove-btn"),this.locationPreviewCard.appendChild(t)}renderAllImgs(e){e.sort(((e,t)=>e.imgOrder-t.imgOrder)).map((e=>e.currentPosition?this.renderLocationCard([e.latitude,e.longitude]):this.renderPreviewCard(e)))}renderToast(e,t="error"){const r=document.createElement("div");r.innerHTML=e,r.classList.add("toast",`toast--${t}`);const n=document.querySelectorAll(".toast");if(n){let e="6rem";for(let t=0;t<n.length;t++)r.style.bottom=`calc(${t+1} * ${e})`}document.body.appendChild(r),setTimeout((()=>r.classList.add("toast--show")),500),setTimeout((()=>r.classList.remove("toast--show")),5e3),setTimeout((()=>document.body.removeChild(r)),5500)}removeRouteInfo(){this.routePreviewCard&&this.routePreviewCard.remove(),this.routePanel&&this.routePanel.remove()}};const v=[-77.041493,38.930859];var P=new class{constructor(){this.map=L.map("map").setView([v[1],v[0]],5),this.tiles=L.tileLayer("https://api.mapbox.com/styles/v1/lanesgood/clhsi5wdt00yk01pffukxf1s4/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibGFuZXNnb29kIiwiYSI6ImNsaHNoeDJ4czJ4b3UzbHFrZHQ3cHNteGsifQ.Pcn60PP-gOgbEb2z9TOAMA",{minZoom:0,maxZoom:22}),this.routeLine=L.polyline([]),this.photoMarkers=L.layerGroup(),this.currentPositionMarker=L.marker()}render(){this.tiles.addTo(this.map),this.photoMarkers.addTo(this.map)}renderPhotoMarker(e,t,r,n){const a=URL.createObjectURL(r),o=L.popup({autoClose:!1}).setContent(`<img class='marker-photo' src='${a}' />`),i=L.marker([e,t]);i.imgId=n,this.photoMarkers.addLayer(i),i.bindPopup(o).openPopup()}flyToDefaultCoords(){this.map.flyTo([v[1],v[0]],10)}flyToImageBounds(e){this.map.flyToBounds(e.map((({latitude:e,longitude:t})=>[e,t])))}renderRouteLine(e,t){const r=e.paths[0].points.coordinates.map((e=>[e[1],e[0]])),a=n(e.paths[0].time);this.routeLine.setLatLngs(r).addTo(this.map),this.routeLine.bindPopup(`${i[t]}: ${a}`).openPopup()}clearRouteLine(){this.routeLine.remove()}};const{state:w}=t,C=async function(e){let r=w.images.length;for(let n=0;n<e.length;n++){const a=e[n];if(w.images.some((e=>e.file?.name===a.name)))f.renderToast(`${a.name} is already in the destination list`,"info");else{const e=r++,n=crypto.randomUUID();try{const r=await t.getExifData(a),o=t.prepareImageData(r,a.name),{latitude:i,longitude:d}=o,s={file:a,imgId:n,imgOrder:e,latitude:i,longitude:d};t.addImage(s),P.renderPhotoMarker(i,d,a,n),f.renderPreviewCard(s),P.flyToImageBounds(w.images)}catch(e){f.renderToast(e),console.error(e)}}}P.clearRouteLine(),f.removeRouteInfo(),f.fileInput.value="",D(w.transportMode)},y=function(e){P.clearRouteLine(),f.removeRouteInfo();let r=e.target.value;t.setTransportMode(r),D(w.transportMode)},I=function(e){const t=w.images.find((t=>t.imgId===e));P.map.flyTo([t.latitude,t.longitude],15),P.photoMarkers.eachLayer((t=>{t.imgId===e&&t.openPopup()}))},_=function(){f.renderRoutePanel(w.routeData,w.transportMode)},k=function(){f.routePanel.remove(),f.renderAllImgs(w.images)},T=function(e){P.photoMarkers.eachLayer((t=>{t.imgId===e&&P.map.removeLayer(t)})),f.imageList.removeChild(f.imageList.querySelector(`[data-img-id="${e}"]`)),t.removeImage("imgId",e),P.clearRouteLine(),f.removeRouteInfo(),D(w.transportMode)},b=async function(e){if(e.target.checked)try{const{coords:{latitude:e,longitude:r}}=await t.getPosition();t.addImage({file:null,imgId:"currentCoords",imgOrder:1e3,latitude:e,longitude:r,currentPosition:!0}),P.currentPositionMarker.setLatLng([e,r]),P.currentPositionMarker.bindPopup("Current location"),P.photoMarkers.addLayer(P.currentPositionMarker),f.renderLocationCard([e,r]),P.currentPositionMarker.openPopup(),P.flyToImageBounds(w.images),D(w.transportMode)}catch(e){console.error(e),f.renderToast(e.message)}else if(!e.target.checked)return P.map.hasLayer(P.currentPositionMarker)&&P.map.removeLayer(P.currentPositionMarker),t.removeImage("currentPosition",!0),w.images.length>0?P.flyToImageBounds(w.images):P.flyToDefaultCoords(),f.imageList.removeChild(f.locationPreviewCard),P.photoMarkers.removeLayer(P.currentPositionMarker),f.removeRouteInfo(),P.clearRouteLine(),D(w.transportMode),w.images},E=function(){let e=w.images.find((e=>e.currentPosition));P.map.flyTo([e.latitude,e.longitude],15)},M=function(){t.removeImage("currentPosition",!0),f.imageList.removeChild(f.locationPreviewCard),f.removeRouteInfo(),P.clearRouteLine(),P.map.hasLayer(P.currentPositionMarker)&&P.map.removeLayer(P.currentPositionMarker),D(w.transportMode)},R=function(){const e=[...f.imageList.querySelectorAll(".preview__card")].map((e=>e.getAttribute("data-img-id")));t.sortImages(e),D(w.transportMode)},D=async function(e){if(!(w.images.length<2)){f.removeRouteInfo(),P.clearRouteLine(),t.setTransportMode(e);try{const e=await t.getRoute(w.transportMode);w.routeData=e,P.flyToImageBounds(w.images),P.renderRouteLine(w.routeData,w.transportMode),f.renderRoutePreviewCard(w.routeData,w.transportMode)}catch(e){f.renderToast(e)}}},H=function(){w.images.length=0,P.photoMarkers.clearLayers(),P.clearRouteLine(),P.flyToDefaultCoords(),f.imageList.replaceChildren(),f.removeRouteInfo(),f.form.reset()};console.log("Snappy trails is up and running. Reticulating splines"),w.images.length>0&&f.renderAllImgs(w.images),P.render(),f.addHandlerUserLocation(b),f.addHandlerFileInput(C),f.addHandlerTransportButton(y),f.addHandlerDropInput(C),f.addHandlerPreviewClick(I),f.addHandlerDragPreviewCard(R),f.addHandlerLocationPreviewClick(E),f.addHandlerRemoveCurrentLocation(M),f.addHandlerRemoveImage(T),f.addHandlerSubmit(D),f.addHandlerRouteCardClick(_),f.addHandlerRoutePanelBack(k),f.addHandlerClear(H);
//# sourceMappingURL=index.d85b29b2.js.map
