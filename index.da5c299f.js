function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var t={};function r(e){return.000621371192*e}function n(e){return new Date(e).toISOString().slice(11,-5)}function a(e,t){return Math.round(e*t)/t}function i(e,t,r,n){var a=e+t/60+r/3600;return"S"!=n&&"W"!=n||(a*=-1),a}e(t,"state",(()=>d)),e(t,"getExifData",(()=>s)),e(t,"getRoute",(()=>c)),e(t,"getPosition",(()=>l));const o={foot:"Hike",bike:"Bike",car:"Car"},d={images:[],currentLatLng:[],transportMode:"",routeData:{}};function s(e){return new Promise((function(t,r){EXIF.getData(e,(function(){const{DateTime:e,GPSImgDirection:n,GPSImgDirectionRef:a,GPSLatitudeRef:o,GPSLatitude:d,GPSLongitudeRef:s,GPSLongitude:c,Make:l,Model:u}=EXIF.getAllTags(this),m=i(d[0],d[1],d[2],o),g=i(c[0],c[1],c[2],s);t({DateTime:e,GPSImgDirection:n,GPSImgDirectionRef:a,latitude:m,longitude:g,Make:l,Model:u}),r(new Error("There was an error "))}))}))}async function c(e){try{const t=d.images.sort(((e,t)=>e.imgOrder-t.imgOrder)).map((({latitude:e,longitude:t})=>[+t,+e])),r=new URLSearchParams({key:"db56c0cf-613e-456d-baea-46650066da62"}).toString(),n=await fetch(`https://graphhopper.com/api/1/route?${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({profile:e,points:t,points_encoded:!1})}),a=await n.json();if(!n.ok)throw new Error(`${a.message}`);return a}catch(e){return console.error(e),e}}const l=function(){return new Promise((function(e,t){navigator.geolocation.getCurrentPosition(e,t)}))};var u=new class{_parentElement=document.querySelector("#upload-form");input=document.querySelector("#fileInput");_submitBtn=document.querySelector("#submit-route-btn");_clearBtn=document.querySelector("#clear-btn");_userLocationInput=document.querySelector("#user-location");imageList=document.querySelector("#image_list");form=document.querySelector("form");dropZone=document.querySelector("#drop_zone");routePreviewCard;routePanel;locationPreviewCard;addHandlerFileInput(e){this.input.addEventListener("change",(async function(t){const r=this.files;r.length&&e(r)}))}addHandlerDropInput(e){["dragenter","dragover","dragleave","drop"].forEach((e=>{this.dropZone.addEventListener(e,a,!1)})),["dragenter","dragover"].forEach((e=>{this.dropZone.addEventListener(e,r,!1)})),["dragleave","drop"].forEach((e=>{this.dropZone.addEventListener(e,n,!1)})),this.dropZone.addEventListener("drop",(async function(t){let r=t.dataTransfer.files;r.length&&e(r)}),!1);const t=document.querySelector("#drop_zone small");function r(e){this.classList.add("highlight"),t.innerText="Drop images to upload"}function n(e){this.classList.remove("highlight"),t.innerText="Upload up to 10 images"}function a(e){e.preventDefault(),e.stopPropagation()}}addHandlerRemoveImage(e){this.imageList.addEventListener("click",(function(t){t.preventDefault();if(!t.target.closest(".preview__card--remove-btn"))return;t.stopImmediatePropagation();const r=t.target.closest(".preview__card").dataset.imgId;e(r)}),!0)}addHandlerPreviewClick(e){this.imageList.addEventListener("click",(function(t){t.preventDefault();const r=t.target.closest(".preview__card")?.dataset.imgId;r&&e(r)}))}addHandlerRouteCardClick(e){document.addEventListener("click",(function(t){t.target.closest(".preview__card--route")&&e()}))}addHandlerLocationPreviewClick(e){this.imageList.addEventListener("click",(function(t){t.preventDefault();t.target.closest(".preview__card--location")&&e()}))}addHandlerRemoveCurrentLocation(e){this.imageList.addEventListener("click",(function(t){if(!t.target.closest(".location__card--remove-btn"))return;t.stopImmediatePropagation(),e();document.querySelector("#user-location").checked=!1}))}addHandlerSubmit(e){this.form.addEventListener("submit",(async t=>{t.preventDefault();const r=new FormData(this.form).get("transport-mode");e(r)}))}addHandlerClear(e){this._clearBtn.addEventListener("click",(t=>{e()}))}addHandlerUserLocation(e){this._userLocationInput.addEventListener("change",(t=>e(t)))}addHandlerRoutePanelBack(e){document.addEventListener("click",(function(t){t.target.closest(".route-panel--back-btn")&&e()}))}addHandlerDragPreviewCard(e){this.imageList.addEventListener("dragstart",(function(e){const t=e.target.closest(".preview__card");t&&t.classList.add("dragging")})),this.imageList.addEventListener("dragend",(function(e){const t=e.target.closest(".preview__card");t&&t.classList.remove("dragging")})),this.imageList.addEventListener("dragover",(function(e){e.preventDefault();const t=document.querySelector(".dragging"),r=(n=this,a=e.clientY,[...n.querySelectorAll(".preview__card:not(.dragging)")].reduce(((e,t)=>{const r=t.getBoundingClientRect(),n=a-r.top-r.height/2;return n<0&&n>e.offset?{offset:n,element:t}:e}),{offset:Number.NEGATIVE_INFINITY}).element);var n,a;null==r?this.appendChild(t):this.insertBefore(t,r);[...this.querySelectorAll(".preview__card")].forEach(((e,t)=>{e.setAttribute("data-img-order",t)}))})),this.imageList.addEventListener("drop",(function(t){t.preventDefault(),e()}))}renderPreviewCard({file:e,file:{exifdata:t},latitude:r,longitude:n,imgId:a,imgOrder:i}){const o=document.createElement("div");o.classList.add("preview__card"),o.setAttribute("draggable","true"),o.setAttribute("title","Drag to reorder image"),o.dataset.imgOrder=i,o.dataset.imgId=a;const d=document.createElement("div");d.classList.add("preview__card--header");const s=document.createElement("div");s.classList.add("preview__card--text");const c=document.createElement("button");c.innerText="✕",c.setAttribute("title","Remove this item"),c.classList.add("preview__card--remove-btn");const l=document.createElement("img");l.classList.add("preview__image"),l.src=URL.createObjectURL(e);const[u,m,g,p,h,f]=t.DateTime.split(/[: ]/),v=new Date(u,m-1,g,p,h,f);s.innerHTML=`\n\n      <dl>\n        <dt>Date:</dt><dd>${v.toLocaleDateString()}</dd>\n        <dt>Time:</dt><dd>${v.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</dd>\n        <dt>lat, lng: </dt><dd>${r.toFixed(2)}, ${n.toFixed(2)}</dd>\n        <dt>Camera:</dd><dd> ${t.Make} ${t.Model}</dd>\n      </dl>\n    `,d.appendChild(l),o.appendChild(d),o.appendChild(c),o.appendChild(s),this.imageList.insertAdjacentElement("beforeend",o)}renderRoutePreviewCard(e){const t=n(e.paths[0].time),i=e.paths[0].distance;document.getElementsByClassName("preview__card--route").length||(this.routePreviewCard=document.createElement("div"),this.routePreviewCard.classList.add("preview__card--text","preview__card--route","preview__card"),this.imageList.insertAdjacentElement("beforebegin",this.routePreviewCard)),this.routePreviewCard.innerHTML=`\n    <h4>Route</h4>\n    <span><h4>${t}</h4>\n    <p>${a(r(i),100)} mi</p>\n    </span>\n    `}renderRoutePanel(e,t){const i=n(e.paths[0].time),o=e.paths[0].distance;document.getElementsByClassName("route-panel").length||(this.routePanel=document.createElement("div"),this.routePanel.classList.add("route-panel","preview__card--text"));const d=e.paths[0].points.coordinates[0].map((e=>e.toFixed(2))).join(", "),s=e.paths[0].points.coordinates.pop().map((e=>e.toFixed(2))).join(", ");this.routePanel.innerHTML=`\n    <h3>${t} Route</h3>\n    <p>From <strong>${d}</strong></p>\n    <p>To <strong>${s}</strong></p>\n    <h2>\n    ${i} <span>(${a(r(o),100)} miles)</span>\n    </h2>\n    `;const c=document.createElement("button");c.innerText="← Back",c.setAttribute("title","Back"),c.classList.add("route-panel--back-btn","btn--small"),this.routePanel.appendChild(c),this.imageList.replaceChildren(this.routePanel);const l=document.createElement("dl");l.innerHTML=`${e.paths[0].instructions.map(((e,t)=>`\n        <dt>${t+1}</dt>\n        <dd>${e.text}</dd>\n      `)).join("")}`,this.routePanel.appendChild(l)}renderLocationCard(e){if(!e)return;document.getElementsByClassName("preview__card--location").length||(this.locationPreviewCard=document.createElement("div"),this.locationPreviewCard.classList.add("preview__card","preview__card--location","preview__card--text"),this.locationPreviewCard.setAttribute("draggable","true"),this.imageList.insertAdjacentElement("afterbegin",this.locationPreviewCard)),this.locationPreviewCard.innerHTML=`\n      <header><h4>Current Location: </h4>\n      <span><p>${e[0].toFixed(2)},${e[1].toFixed(2)}</p>\n      </span></header>\n    `;const t=document.createElement("button");t.innerText="x",t.setAttribute("title","Remove current location"),t.classList.add("location__card--remove-btn"),this.locationPreviewCard.appendChild(t)}renderAllImgs(e){e.sort(((e,t)=>e.imgOrder-t.imgOrder)).filter((e=>null!=e.file)).map((e=>this.renderPreviewCard(e)))}};const m=[-77.041493,38.930859];var g=new class{constructor(){this.map=L.map("map").setView([m[1],m[0]],5),this.tiles=L.tileLayer("https://api.mapbox.com/styles/v1/lanesgood/clhsi5wdt00yk01pffukxf1s4/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibGFuZXNnb29kIiwiYSI6ImNsaHNoeDJ4czJ4b3UzbHFrZHQ3cHNteGsifQ.Pcn60PP-gOgbEb2z9TOAMA",{minZoom:0,maxZoom:22}),this.routeLine=L.polyline([]),this.photoMarkers=L.layerGroup(),this.currentPositionMarker=L.marker()}render(){this.tiles.addTo(this.map),this.photoMarkers.addTo(this.map)}renderPhotoMarker(e,t,r,n){const a=URL.createObjectURL(r),i=L.popup({autoClose:!1}).setContent(`<img class='marker-photo' src='${a}' />`),o=L.marker([e,t]);o.imgId=n,this.photoMarkers.addLayer(o),o.bindPopup(i).openPopup()}flyToDefaultCoords(){this.map.flyTo([m[1],m[0]],10)}flyToImageBounds(e){this.map.flyToBounds(e.map((({latitude:e,longitude:t})=>[e,t])))}renderRouteLine(e,t){const r=e.paths[0].points.coordinates.map((e=>[e[1],e[0]])),a=n(e.paths[0].time);this.routeLine.setLatLngs(r).addTo(this.map),this.routeLine.bindPopup(`${o[t]}: ${a}`).openPopup()}clearRouteLine(){this.routeLine.remove()}};const{state:p}=t,h=async function(e){let r=p.images.length;for(let n=0;n<e.length;n++){const a=e[n];if(p.images.some((e=>e.file?.name===a.name)))alert(`${a.name} is already in the destination list`);else{const e=r++,n=crypto.randomUUID();try{const r=await t.getExifData(a),{latitude:i,longitude:o}=r,d={file:a,imgId:n,imgOrder:e,latitude:i,longitude:o};p.images.push(d),g.renderPhotoMarker(i,o,a,n),u.renderPreviewCard(d),g.flyToImageBounds(p.images)}catch(e){console.error(e),alert("Could not extract location data for this image")}}}g.clearRouteLine(),u.input.value="",u.checkSubmitBtn(p.images.length)},f=function(e){const t=p.images.find((t=>t.imgId===e));g.map.flyTo([t.latitude,t.longitude],15),g.photoMarkers.eachLayer((t=>{t.imgId===e&&t.openPopup()}))},v=function(){u.renderRoutePanel(p.routeData,p.transportMode)},P=function(){u.routePanel.remove(),u.renderAllImgs(p.images)},w=function(e){g.photoMarkers.eachLayer((t=>{t.imgId===e&&g.map.removeLayer(t)})),u.imageList.removeChild(u.imageList.querySelector(`[data-img-id="${e}"]`)),p.images=p.images.filter((t=>t.imgId!==e)),g.clearRouteLine(),u.checkSubmitBtn(p.images.length)},C=async function(e){if(e.target.checked)try{const{coords:{latitude:e,longitude:r}}=await t.getPosition();p.images.push({file:null,imgId:"currentCoords",imgOrder:1e3,latitude:e,longitude:r,currentPosition:!0}),g.currentPositionMarker.setLatLng([e,r]),g.currentPositionMarker.bindPopup("Current location"),g.photoMarkers.addLayer(g.currentPositionMarker),u.renderLocationCard([e,r]),g.currentPositionMarker.openPopup(),g.flyToImageBounds(p.images),u.checkSubmitBtn(p.images.length)}catch(e){console.error(e),alert("User location not available")}else if(!e.target.checked)return g.map.hasLayer(g.currentPositionMarker)&&g.map.removeLayer(g.currentPositionMarker),p.images=p.images.filter((e=>!e.currentPosition)),p.images.length>0?g.flyToImageBounds(p.images):g.flyToDefaultCoords(),u.imageList.removeChild(u.locationPreviewCard),g.photoMarkers.removeLayer(g.currentPositionMarker),u.checkSubmitBtn(p.images.length),p.images},y=function(){let e=p.images.find((e=>e.currentPosition));g.map.flyTo([e.latitude,e.longitude],15)},k=function(){p.images=p.images.filter((e=>!e.currentPosition)),u.imageList.removeChild(u.locationPreviewCard),u.checkSubmitBtn(p.images.length),g.map.hasLayer(g.currentPositionMarker)&&g.map.removeLayer(g.currentPositionMarker)},_=function(){const e=[...u.imageList.querySelectorAll(".preview__card")].map((e=>e.getAttribute("data-img-id")));p.images=p.images.sort(((t,r)=>e.indexOf(t.imgId)-e.indexOf(r.imgId))).map(((e,t)=>({...e,imgOrder:t})))},b=async function(e){p.transportMode=e;const r=await t.getRoute(p.transportMode);p.routeData=r,g.flyToImageBounds(p.images),g.renderRouteLine(p.routeData,p.transportMode),u.renderRoutePreviewCard(p.routeData,p.transportMode)},E=function(){p.images.length=0,g.photoMarkers.clearLayers(),g.clearRouteLine(),g.flyToDefaultCoords(),u.imageList.replaceChildren(),u.routePreviewCard&&u.routePreviewCard.remove(),u.routePanel&&u.routePanel.remove(),u.form.reset(),u.checkSubmitBtn(p.images.length)};console.log("Snappy trails is up and running. Reticulating splines"),p.images.length>0&&u.renderAllImgs(p.images),g.render(),u.addHandlerUserLocation(C),u.addHandlerFileInput(h),u.addHandlerDropInput(h),u.addHandlerPreviewClick(f),u.addHandlerDragPreviewCard(_),u.addHandlerLocationPreviewClick(y),u.addHandlerRemoveCurrentLocation(k),u.addHandlerRemoveImage(w),u.addHandlerSubmit(b),u.addHandlerRouteCardClick(v),u.addHandlerRoutePanelBack(P),u.addHandlerClear(E);
//# sourceMappingURL=index.da5c299f.js.map
